<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="../styles/cartStyle.css" />
    <title>Document</title>
  </head>
  <body>
    <div class="header">
      <div class="logo"><img src="../static/images/logo.png" /></div>

      <div class="tabs">
        <a href="./index.html">Home</a>
        <a href="./plp.html">Products</a>
      </div>
      <div class="cart">
        <div class="register">
          <a href="./signIn.html">SignIn</a>
          <a href="./register.html">Register</a>
        </div>
        <div class="cartWrapper">
          <img
            alt="cart icon"
            class="cartIcon"
            src="https://raw.githubusercontent.com/gautam-in/shopping-cart-assignment/master/static/images/cart.svg"
          />
          <a href="./cart.html"> cart</a>
        </div>
      </div>
    </div>
    <div class="cartHeading">
      <h2>My Cart</h2>
    </div>
    <div class="cartContainer">
      <section class="product-list-main"></section>
      <div class="cart-total">
        <strong class="cart-total-title">Total</strong>
        <span class="cart-total-price">Rs0</span>
      </div>
      <button class="checkoutButton">Proceed to Checkout</button>
    </div>

    <div class="footer">
      Copyrights Â© 2011-2018 Sabka Bazaar Grocery Supplies Pvt. Ltd
    </div>
    <!-- <button>-</button><span>1</span><button>+</button><span>x</span -->
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        updateCartTotal();
      });
      let container = document.querySelector(".product-list-main");
      var sessionString = localStorage.getItem("cartItems");
      var cartArray = JSON.parse(sessionString);
      cartArray?.map((el, index) => {
        const html = ` 
          
           
           <section class="cart-item-container">
            <section class="cart-left-block">
              <img class=" hide-on-tablet hide-on-mobile" src=${el?.imageURL}
               style="width:130px; height:130px;" />
               <section class="cart-item-details">
                <h4>${el?.name}</h4>
                <section class="cart-item-actions">
                  <input class="cart-quantity-input" type="number" id="quantity" name="quantity" min="1"  value="1">
                
          <span class="cart-price">Rs${el?.price}</span></section>
                </section>
               </section>
               <section class="cart-item-rate">Rs${el?.price}</section>
               
               </section>
              
               `;
        container.insertAdjacentHTML("afterbegin", html);
      });
      var quantityInputs = document.getElementsByClassName(
        "cart-quantity-input"
      );
      for (var i = 0; i < quantityInputs.length; i++) {
        var input = quantityInputs[i];
        input.addEventListener("change", quantityChanged);
      }
      function quantityChanged(event) {
        var input = event.target;
        if (isNaN(input.value) || input.value <= 0) {
          input.value = 1;
        }

        updateCartTotal();
      }

      function updateCartTotal() {
        var cartItemContainer =
          document.getElementsByClassName("product-list-main")[0];
        var cartRows = cartItemContainer.getElementsByClassName(
          "cart-item-container"
        );
        var total = 0;
        for (var i = 0; i < cartRows.length; i++) {
          var cartRow = cartRows[i];
          var priceElement = cartRow.getElementsByClassName("cart-price")[0];
          var quantityElement = cartRow.getElementsByClassName(
            "cart-quantity-input"
          )[0];
          var price = parseFloat(priceElement.innerText.replace("Rs", ""));
          var quantity = quantityElement.value;
          total = total + price * quantity;
        }
        total = Math.round(total * 100) / 100;
        console.log("total", total);
        document.getElementsByClassName("cart-total-price")[0].innerText =
          "Rs" + total;
      }
      console.log("cartPage", cartArray);
    </script>
  </body>
</html>
