<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="../styles/plpStyles.css" />
    <title>Document</title>
  </head>
  <body>
    <div class="bodyContainer">
      <div class="pageContainer">
        <div class="header">
          <div class="logo"><img src="../static/images/logo.png" /></div>

          <div class="tabs">
            <a href="./index.html">Home</a>
            <a href="./plp.html">Products</a>
          </div>
          <div class="cart">
            <div class="register">
              <a href="./signIn.html">SignIn</a>
              <a href="./register.html">Register</a>
            </div>
            <div class="cartWrapper">
              <img
                alt="cart icon"
                class="cartIcon"
                src="https://raw.githubusercontent.com/gautam-in/shopping-cart-assignment/master/static/images/cart.svg"
              />
              <a href="./cart.html"> cart</a>
            </div>
          </div>
        </div>
        <select class="product-list-nav-mobile">
          <option>Fruits & Vegetables</option>
          <option>Bakery Cakes & Dairy</option>
          <option>Beverages</option>
          <option>Beauty & Hygiene</option>
          <option>Baby Care</option>
        </select>

        <div class="containerDiv">
          <!-- <div class="leftCard"> -->
          <ul class="product-list-nav">
            <li>Fruits & Vegetables</li>
            <li>Bakery Cakes & Dairy</li>
            <li>Beverages</li>
            <li>Beauty & Hygiene</li>
            <li>Baby Care</li>
          </ul>
          <!-- </div> -->
          <!-- <div class="rightWrapper cardContainer"> -->
          <section class="product-list-main"></section>
          <!-- <ul class="cardContainer"></ul> -->
          <!-- </div> -->
        </div>
      </div>
    </div>

    <script>
      let container = document.querySelector(".product-list-main");
      let state = { categories: [] };
      var items = [];
      var cart = [];
      fetch("../server/products/index.get.json")
        .then((response) => response.json())
        .then((data) => {
          // item.push(...data);
          data.map((el) => {
            items.push(el);
          });
        })
        .catch((error) => console.log(error));
      console.log("item", items);
      setTimeout(() => {
        items?.map((el, index) => {
          const html = ` <section class ="product-box">
          
                  <h3>${el?.name} </h3>
              <img class=" hide-on-tablet hide-on-mobile" src=${el?.imageURL} />
              <section class="product-container-mobile only-on-mobile">
              <img
              src=${el?.imageURL}
               
                class="hide-on-tablet"
              />
              <section class="product-details-mobile">
                <p>
                  ${el?.description}
                </p>
                <button id="myButton"  data-obj=${index} class="explore btn btn-primary shop-item-button"   >Buy Now</button> 
              </section>
              
            </section>
            <p class="hide-on-tablet hide-on-mobile">
                ${el?.description}
            </p>
            <section class="product-details-tablet hide-on-mobile">
              <img
              src=${el?.imageURL}
             
              />
              <p>
                ${el?.description}
              </p>
            </section>
            <div class="price-cta-section hide-on-mobile">
              <span class="hide-on-tablet">${el?.price}</span>
              <button id="myButton"  data-obj=${index} class="hide-on-tablet explore btn btn-primary shop-item-button"   >Buy Now @ Rs ${el?.price}  </button> 
              <button id="myButton"  data-obj=${index} class="hide-on-desktop explore btn btn-primary shop-item-button"   >Buy Now @ Rs ${el?.price}</button> 
          
            </div>
            
         </div>
           </section> `;
          container.insertAdjacentHTML("afterbegin", html);
        });
        var domClass = document.querySelectorAll(".shop-item-button");
        console.log("domClass", domClass);
        domClass.forEach((b) => {
          b.addEventListener("click", (e) => {
            e.preventDefault();

            // window.location.push();
            if (!cart.length) cart.push(items[b.dataset.obj]);
            else {
              let itemIndex = cart.find(
                (item) => item.id === items[b.dataset.obj].id
              );
              if (!itemIndex) cart.push(items[b.dataset.obj]);
              else {
                let newCart = cart.filter((item) => item.id !== itemIndex.id);
                cart = [
                  ...newCart,
                  {
                    ...items[b.dataset.obj],
                    qty: items[b.dataset.obj].qty + 1,
                  },
                ];
              }
            }
            console.log(cart);
          });
        });
      }, 1000);
    </script>
  </body>
</html>
